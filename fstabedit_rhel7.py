#####################################################################################
'''
The script is to update File system's options as per the suggestions from
vulnerability solutions to fix below vulnerabilities on the OS side.

Steps to follow:

1) Push the script to the servers
2) Execute the script using command "python fstabedit.py"
3) The new version of fstab file would be saved to /etc/fstab_new
4) Check if the changes are fine and rename the fstab files
     # mv /etc/fstab /etc/fstab.old
     # mv /etc/fstab_new /etc/fstab

Author : Venugopal P(vp00007)
Created date : 9/26/2020

Requirments 
Python version used : 2.7.5
Modules used : os

Note - For LINUX servers only
'''
#####################################################################################

import os
print('Backing up /etc/fstab as /etc/fstab_pybackup...')

os.system('/bin/cp -pr /etc/fstab /etc/fstab_pybackup')

f = open('/etc/fstab','r')
message = f.read()
lines = message.split('\n')
fnew = open('/etc/fstab_new','w')
print('Extracting data from /etc/fstab and updating the options for local File systems....')
for i in range(len(lines) - 1):
    if '/boot' and 'UUID' in lines[i] or '/opt' and 'optlv' in lines[i] or '/var/log' and 'varloglv' in lines[i] or '/var/log/audit' and 'varlogauditlv' in lines[i] or'/usr' and 'usrlv' in lines[i]:
        line = lines[i].split()
        line[3] = 'defaults,nodev'
        line = ' '.join(line)
        fnew.write(line+'\n')
    elif '/var/tmp' in lines[i]:
        line = lines[i].split()
        line[3] = 'bind,nodev'
        line = ' '.join(line)
        fnew.write(line+'\n')
    elif '/home' and 'homelv' in lines[i]:
        line = lines[i].split()
        line[3] = 'defaults,nodev,nosuid'
        line = ' '.join(line)
        fnew.write(line+'\n')
    elif '/tmp' and 'tmplv' in lines[i]:
        line = lines[i].split()
        line[3] = 'defaults,nodev,nosuid'
        line = ' '.join(line)
        fnew.write(line+'\n')
    elif '/var' and 'varlv' in lines[i]:
	line = lines[i].split()
	line[3] = 'defaults,nodev,noexec,nosuid'
	line = ' '.join(line)
	fnew.write(line+'\n')
    else :
        line = str(lines[i]+'\n')
        fnew.write(line)
print('Saving the output to /etc/fstab_new...')
fnew.close()
print('Completed')
f.close()

